{{template "top" $}}

<div class="row">
  <div class="col-lg-8">
    <div class="card border-primary mb-3" style="max-width: 20rem;">
      <h3 class="card-header">{{$.Data.Name}}</h3>
      <div class="card-body">
        <p class="card-text">
          {{if $.Data.FirstSeen}}
          First Seen: {{date $.Data.FirstSeen}} <br />
          {{end}}
          {{if $.Data.LastSeen}}
          Last Seen: {{date $.Data.LastSeen}} <br />
          {{end}}
          {{if $.Data.ImportData}}
          First Import: {{date $.Data.ImportData.FirstImportDate}} <br />
          Last Import: {{date $.Data.ImportData.LastImportDate}} <br />
          Number of Zone Imports: {{nfmt $.Data.ImportData.Count}} <br />
          Number of Domains: {{nfmt $.Data.ImportData.Domains}} <br />
          {{end}}
        </p>
      </div>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-md-6">
    <div class="card">
      <a href="#" class="list-group-item d-flex justify-content-between align-items-center active">
        Current Nameservers
        <span class="badge badge-light badge-pill">{{count (len $.Data.NameServers) $.Data.NameServerCount}}</span>
      </a>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>First Seen</th>
          </tr>
        </thead>
        <tbody>
          {{ range $key, $value := $.Data.NameServers }}
          <tr>
            <td><a href="/nameservers/{{$value.Name}}">{{$value.Name}}</a></td>
            <td>{{date $value.FirstSeen}}</td>
          </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card">
      <a href="#" class="list-group-item d-flex justify-content-between align-items-center active">
        Past Nameservers
        <span
          class="badge badge-light badge-pill">{{count (len $.Data.ArchiveNameServers) $.Data.ArchiveNameServerCount}}</span>
      </a>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>First Seen</th>
            <th>Last Seen</th>
          </tr>
        </thead>
        <tbody>
          {{ range $key, $value := $.Data.ArchiveNameServers }}
          <tr>
            <td><a href="/nameservers/{{$value.Name}}">{{$value.Name}}</a></td>
            <td>{{date $value.FirstSeen}}</td>
            <td>{{date $value.LastSeen}}</td>
          </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </div>
</div>

{{if $.Data.ImportData}}
<div class="row">
  <div class="col-md-12">
    <div class="card">
      <a href="#chart" id="chart" class="list-group-item d-flex justify-content-between align-items-center active">
        Zone Growth
      </a>
      <div id="spinner1" class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>
      <div id='historyDiv'></div>
    </div>
    <script>
      fetch("/api/counts/zone/{{$.Data.Name}}")
        .then(response => response.json())
        .then(api_response => {
          dates = [];
          domains = [];
          oldC = [];
          movedC = [];
          newC = [];
          api_response.data.history.forEach(function (e) {
            dates.push(e.date);
            domains.push(e.domains);
            oldC.push(e.old);
            movedC.push(e.moved);
            newC.push(e.new);
          });

          var data = [{
            x: dates,
            y: domains,
            type: 'scatter',
            mode: "lines",
            name: "Domains (total)",
            line: {
                dash: 'dot',
            },  
          },
          {
            x: dates,
            y: oldC,
            type: 'scatter',
            mode: "lines",
            name: "Removed (delta)",
            yaxis: 'y2',
          },
          {
            x: dates,
            y: movedC,
            type: 'scatter',
            mode: "lines",
            name: "Transferred (delta)",
            yaxis: 'y2',
          },
          {
            x: dates,
            y: newC,
            type: 'scatter',
            mode: "lines",
            name: "New (delta)",
            yaxis: 'y2',
          }];

          var layout = {
            autosize: true,
            showlegend: true,
            automargin: true,
            yaxis: { title: 'Total Domains' },
            yaxis2: {
              title: 'Deltas',
              overlaying: 'y',
              side: 'right'
            }
          };

          Plotly.newPlot('historyDiv', data, layout, { displaylogo: false }).then(function () { $("#spinner1").hide() });
        });
    </script>
  </div>
</div>
{{end}}


{{if $.Data.Domains}}
<div class="row">
  <div class="col-md-6">
    <div class="card">
      <a href="#" class="list-group-item d-flex justify-content-between align-items-center active">
        Sample Domains
      </a>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Last Seen</th>
          </tr>
        </thead>
        <tbody>
          {{ range $key, $value := $.Data.Domains }}
          <tr>
            <td><a href="/domains/{{$value.Name}}">{{$value.Name}}</a></td>
            <td>{{date $value.LastSeen}}</td>
          </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
  </div>
</div>
{{end}}


{{template "bottom" $}}
